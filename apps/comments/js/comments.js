!function(n){var e={};function t(a){if(e[a])return e[a].exports;var l=e[a]={i:a,l:!1,exports:{}};return n[a].call(l.exports,l,l.exports,t),l.l=!0,l.exports}t.m=n,t.c=e,t.d=function(n,e,a){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:a})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var l in n)t.d(a,l,function(e){return n[e]}.bind(null,l));return a},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="/js/",t(t.s=475)}({475:function(n,e,t){"use strict";t.r(e);t(476),t(477),t(478),t(479);window.OCA.Comments=OCA.Comments},476:function(n,e){OCA.Comments||(OCA.Comments={})},477:function(n,e){var t,a;t=Handlebars.template,(a=OCA.Comments.Templates=OCA.Comments.Templates||{}).comment=t({1:function(n,e,t,a,l){return" unread"},3:function(n,e,t,a,l){return" collapsed"},5:function(n,e,t,a,l){return" currentUser"},7:function(n,e,t,a,l){var s;return'data-username="'+n.escapeExpression("function"==typeof(s=null!=(s=t.actorId||(null!=e?e.actorId:e))?s:t.helperMissing)?s.call(null!=e?e:n.nullContext||{},{"name":"actorId","hash":{},"data":l}):s)+'"'},9:function(n,e,t,a,l){return'\t\t\t<a href="#" class="action more icon icon-more has-tooltip"></a>\n\t\t\t<div class="deleteLoading icon-loading-small hidden"></div>\n'},11:function(n,e,t,a,l){return'\t\t<div class="message-overlay"></div>\n'},"compiler":[7,">= 4.0.0"],"main":function(n,e,t,a,l){var s,i,o=null!=e?e:n.nullContext||{},r=t.helperMissing,c="function",m=n.escapeExpression;return'<li class="comment'+(null!=(s=t.if.call(o,null!=e?e.isUnread:e,{"name":"if","hash":{},"fn":n.program(1,l,0),"inverse":n.noop,"data":l}))?s:"")+(null!=(s=t.if.call(o,null!=e?e.isLong:e,{"name":"if","hash":{},"fn":n.program(3,l,0),"inverse":n.noop,"data":l}))?s:"")+'" data-id="'+m(typeof(i=null!=(i=t.id||(null!=e?e.id:e))?i:r)===c?i.call(o,{"name":"id","hash":{},"data":l}):i)+'">\n\t<div class="authorRow">\n\t\t<div class="avatar'+(null!=(s=t.if.call(o,null!=e?e.isUserAuthor:e,{"name":"if","hash":{},"fn":n.program(5,l,0),"inverse":n.noop,"data":l}))?s:"")+'" '+(null!=(s=t.if.call(o,null!=e?e.actorId:e,{"name":"if","hash":{},"fn":n.program(7,l,0),"inverse":n.noop,"data":l}))?s:"")+'> </div>\n\t\t<div class="author'+(null!=(s=t.if.call(o,null!=e?e.isUserAuthor:e,{"name":"if","hash":{},"fn":n.program(5,l,0),"inverse":n.noop,"data":l}))?s:"")+'">'+m(typeof(i=null!=(i=t.actorDisplayName||(null!=e?e.actorDisplayName:e))?i:r)===c?i.call(o,{"name":"actorDisplayName","hash":{},"data":l}):i)+"</div>\n"+(null!=(s=t.if.call(o,null!=e?e.isUserAuthor:e,{"name":"if","hash":{},"fn":n.program(9,l,0),"inverse":n.noop,"data":l}))?s:"")+'\t\t<div class="date has-tooltip live-relative-timestamp" data-timestamp="'+m(typeof(i=null!=(i=t.timestamp||(null!=e?e.timestamp:e))?i:r)===c?i.call(o,{"name":"timestamp","hash":{},"data":l}):i)+'" title="'+m(typeof(i=null!=(i=t.altDate||(null!=e?e.altDate:e))?i:r)===c?i.call(o,{"name":"altDate","hash":{},"data":l}):i)+'">'+m(typeof(i=null!=(i=t.date||(null!=e?e.date:e))?i:r)===c?i.call(o,{"name":"date","hash":{},"data":l}):i)+'</div>\n\t</div>\n\t<div class="message">'+(null!=(s=typeof(i=null!=(i=t.formattedMessage||(null!=e?e.formattedMessage:e))?i:r)===c?i.call(o,{"name":"formattedMessage","hash":{},"data":l}):i)?s:"")+"</div>\n"+(null!=(s=t.if.call(o,null!=e?e.isLong:e,{"name":"if","hash":{},"fn":n.program(11,l,0),"inverse":n.noop,"data":l}))?s:"")+"</li>\n"},"useData":!0}),a.commentsmodifymenu=t({1:function(n,e,t,a,l){var s,i,o=null!=e?e:n.nullContext||{},r=t.helperMissing,c=n.escapeExpression;return'\t\t<li>\n\t\t\t<a href="#" class="menuitem action '+c("function"==typeof(i=null!=(i=t.name||(null!=e?e.name:e))?i:r)?i.call(o,{"name":"name","hash":{},"data":l}):i)+' permanent" data-action="'+c("function"==typeof(i=null!=(i=t.name||(null!=e?e.name:e))?i:r)?i.call(o,{"name":"name","hash":{},"data":l}):i)+'">\n'+(null!=(s=t.if.call(o,null!=e?e.iconClass:e,{"name":"if","hash":{},"fn":n.program(2,l,0),"inverse":n.program(4,l,0),"data":l}))?s:"")+"\t\t\t\t<span>"+c("function"==typeof(i=null!=(i=t.displayName||(null!=e?e.displayName:e))?i:r)?i.call(o,{"name":"displayName","hash":{},"data":l}):i)+"</span>\n\t\t\t</a>\n\t\t</li>\n"},2:function(n,e,t,a,l){var s;return'\t\t\t\t\t<span class="icon '+n.escapeExpression("function"==typeof(s=null!=(s=t.iconClass||(null!=e?e.iconClass:e))?s:t.helperMissing)?s.call(null!=e?e:n.nullContext||{},{"name":"iconClass","hash":{},"data":l}):s)+'"></span>\n'},4:function(n,e,t,a,l){return'\t\t\t\t\t<span class="no-icon"></span>\n'},"compiler":[7,">= 4.0.0"],"main":function(n,e,t,a,l){var s;return"<ul>\n"+(null!=(s=t.each.call(null!=e?e:n.nullContext||{},null!=e?e.items:e,{"name":"each","hash":{},"fn":n.program(1,l,0),"inverse":n.noop,"data":l}))?s:"")+"</ul>\n"},"useData":!0}),a.edit_comment=t({1:function(n,e,t,a,l){var s;return'\t\t\t<div class="action-container">\n\t\t\t\t<a href="#" class="action cancel icon icon-close has-tooltip" title="'+n.escapeExpression("function"==typeof(s=null!=(s=t.cancelText||(null!=e?e.cancelText:e))?s:t.helperMissing)?s.call(null!=e?e:n.nullContext||{},{"name":"cancelText","hash":{},"data":l}):s)+'"></a>\n\t\t\t</div>\n'},"compiler":[7,">= 4.0.0"],"main":function(n,e,t,a,l){var s,i,o=null!=e?e:n.nullContext||{},r=t.helperMissing,c="function",m=n.escapeExpression;return"<"+m(typeof(i=null!=(i=t.tag||(null!=e?e.tag:e))?i:r)===c?i.call(o,{"name":"tag","hash":{},"data":l}):i)+' class="newCommentRow comment" data-id="'+m(typeof(i=null!=(i=t.id||(null!=e?e.id:e))?i:r)===c?i.call(o,{"name":"id","hash":{},"data":l}):i)+'">\n\t<div class="authorRow">\n\t\t<div class="avatar currentUser" data-username="'+m(typeof(i=null!=(i=t.actorId||(null!=e?e.actorId:e))?i:r)===c?i.call(o,{"name":"actorId","hash":{},"data":l}):i)+'"></div>\n\t\t<div class="author currentUser">'+m(typeof(i=null!=(i=t.actorDisplayName||(null!=e?e.actorDisplayName:e))?i:r)===c?i.call(o,{"name":"actorDisplayName","hash":{},"data":l}):i)+"</div>\n"+(null!=(s=t.if.call(o,null!=e?e.isEditMode:e,{"name":"if","hash":{},"fn":n.program(1,l,0),"inverse":n.noop,"data":l}))?s:"")+'\t</div>\n\t<form class="newCommentForm">\n\t\t<div contentEditable="true" class="message" data-placeholder="'+m(typeof(i=null!=(i=t.newMessagePlaceholder||(null!=e?e.newMessagePlaceholder:e))?i:r)===c?i.call(o,{"name":"newMessagePlaceholder","hash":{},"data":l}):i)+'">'+m(typeof(i=null!=(i=t.message||(null!=e?e.message:e))?i:r)===c?i.call(o,{"name":"message","hash":{},"data":l}):i)+'</div>\n\t\t<input class="submit icon-confirm has-tooltip" type="submit" value="" title="'+m(typeof(i=null!=(i=t.submitText||(null!=e?e.submitText:e))?i:r)===c?i.call(o,{"name":"submitText","hash":{},"data":l}):i)+'"/>\n\t\t<div class="submitLoading icon-loading-small hidden"></div>\n\t</form>\n</'+m(typeof(i=null!=(i=t.tag||(null!=e?e.tag:e))?i:r)===c?i.call(o,{"name":"tag","hash":{},"data":l}):i)+">\n"},"useData":!0}),a.filesplugin=t({"compiler":[7,">= 4.0.0"],"main":function(n,e,t,a,l){var s,i=null!=e?e:n.nullContext||{},o=t.helperMissing,r=n.escapeExpression;return'<a class="action action-comment permanent" title="'+r("function"==typeof(s=null!=(s=t.countMessage||(null!=e?e.countMessage:e))?s:o)?s.call(i,{"name":"countMessage","hash":{},"data":l}):s)+'" href="#">\n\t<img class="svg" src="'+r("function"==typeof(s=null!=(s=t.iconUrl||(null!=e?e.iconUrl:e))?s:o)?s.call(i,{"name":"iconUrl","hash":{},"data":l}):s)+'"/>\n</a>\n'},"useData":!0}),a.view=t({"compiler":[7,">= 4.0.0"],"main":function(n,e,t,a,l){var s,i=null!=e?e:n.nullContext||{},o=t.helperMissing,r=n.escapeExpression;return'<ul class="comments">\n</ul>\n<div class="emptycontent hidden"><div class="icon-comment"></div>\n\t<p>'+r("function"==typeof(s=null!=(s=t.emptyResultLabel||(null!=e?e.emptyResultLabel:e))?s:o)?s.call(i,{"name":"emptyResultLabel","hash":{},"data":l}):s)+'</p></div>\n<input type="button" class="showMore hidden" value="'+r("function"==typeof(s=null!=(s=t.moreLabel||(null!=e?e.moreLabel:e))?s:o)?s.call(i,{"name":"moreLabel","hash":{},"data":l}):s)+'" name="show-more" id="show-more" />\n<div class="loading hidden" style="height: 50px"></div>\n'},"useData":!0})},478:function(e,a){_.extend(OC.Files.Client,{PROPERTY_COMMENTS_UNREAD:"{"+OC.Files.Client.NS_OWNCLOUD+"}comments-unread"}),OCA.Comments=_.extend({},OCA.Comments),OCA.Comments||(OCA.Comments={}),OCA.Comments.FilesPlugin={ignoreLists:["trashbin","files.public"],_formatCommentCount:e=>OCA.Comments.Templates.filesplugin({count:e,countMessage:n("comments","%n unread comment","%n unread comments",e),iconUrl:OC.imagePath("core","actions/comment")}),attach(e){const a=this;if(this.ignoreLists.indexOf(e.id)>=0)return;const l=e._getWebdavProperties;e._getWebdavProperties=function(){const n=l.apply(this,arguments);return n.push(OC.Files.Client.PROPERTY_COMMENTS_UNREAD),n},e.filesClient.addFileInfoParser((function(n){const e={},t=n.propStat[0].properties[OC.Files.Client.PROPERTY_COMMENTS_UNREAD];return _.isUndefined(t)||""===t||(e.commentsUnread=parseInt(t,10)),e})),e.$el.addClass("has-comments");const s=e._createRow;e._createRow=function(n){const e=s.apply(this,arguments);return n.commentsUnread&&e.attr("data-comments-unread",n.commentsUnread),e},e.fileActions.registerAction({name:"Comment",displayName(e){if(e&&e.$file){const t=parseInt(e.$file.data("comments-unread"),10);if(t>=0)return n("comments","1 new comment","{unread} new comments",t,{unread:t})}return t("comments","Comment")},mime:"all",order:-140,iconClass:"icon-comment",permissions:OC.PERMISSION_READ,type:OCA.Files.FileActions.TYPE_INLINE,render(n,e,t){const l=t.$file.data("comments-unread");if(l){const n=$(a._formatCommentCount(l));return t.$file.find("a.name>span.fileactions").append(n),n}return""},actionHandler(n,e){e.$file.find(".action-comment").tooltip("hide"),OCA.Files.Sidebar.setActiveTab("comments"),OCA.Files.Sidebar.open("/"+n)}});const i=e.elementToFile;e.elementToFile=function(n){const e=i.apply(this,arguments),t=n.data("comments-unread");return t&&(e.commentsUnread=t),e}}},OC.Plugins.register("OCA.Files.FileList",OCA.Comments.FilesPlugin)},479:function(n,e){OCA.Comments.ActivityTabViewPlugin={prepareModelForDisplay(n,e,t){if("comments"===n.get("app")&&"comments"===n.get("type")&&"ActivityTabView"===t&&(e.addClass("comment"),n.get("message")&&this._isLong(n.get("message")))){e.addClass("collapsed");const n=$("<div>").addClass("message-overlay");e.find(".activitymessage").after(n),e.on("click",this._onClickCollapsedComment)}},_onClickCollapsedComment(n){let e=$(n.target);e.is(".comment")||(e=e.closest(".comment")),e.removeClass("collapsed")},_isLong:n=>n.length>250||(n.match(/\n/g)||[]).length>1},OC.Plugins.register("OCA.Activity.RenderingPlugins",OCA.Comments.ActivityTabViewPlugin)}});
//# sourceMappingURL=comments.js.map